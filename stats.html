<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ•°æ®ç»Ÿè®¡ - å‚é“åšå®¢ç¿»è¯‘</title>
  
  <!-- âœ… ç½‘ç«™å›¾æ ‡ -->
  <link rel="icon" type="image/jpeg" href="/images/sakamichi.jpg">
  <link rel="apple-touch-icon" href="/images/sakamichi.jpg">
  <meta name="theme-color" content="#742581">
  
  <!-- âœ… æ€§èƒ½ä¼˜åŒ–ï¼šé¢„è¿æ¥ -->
  <link rel="preconnect" href="https://api.sakamichi-tools.cn">
  
  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3218605960303034"
     crossorigin="anonymous"></script>
  
  <!-- DaisyUI + Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.19/dist/full.min.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- ç°æœ‰CSSæ–‡ä»¶ -->
  <link rel="stylesheet" href="css/main-styles.css">
  <link rel="stylesheet" href="css/mobile.css">
  <link rel="stylesheet" href="css/transitions.css">
  <link rel="stylesheet" href="css/dark-theme.css">
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- é…ç½®æ–‡ä»¶ -->
  <script src="js/config.js"></script>
  <script src="js/state.js"></script>
  <script src="js/group-config.js"></script>
  
  <!-- ğŸ¯ SEO ç®¡ç†å™¨ -->
  <script src="js/seo-manager.js"></script>

  <!-- ä¸»é¢˜åˆ‡æ¢æ¨¡å— -->
  <script src="js/theme-toggle.js"></script>

  <!-- ç®€ç¹åˆ‡æ¢æ¨¡å— -->
  <script src="js/language-toggle.js"></script>

  <!-- ç§»åŠ¨ç«¯èœå• -->
  <script src="js/mobile-menu.js"></script>
  
  <style>
    body {
      font-family: 'Noto Sans SC', 'Noto Sans JP', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f5f5f5;
    }
    
    .stat-card {
      background: white;
      border-radius: 0;
      padding: 24px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    
    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    
    .stat-number {
      font-size: 48px;
      font-weight: bold;
      line-height: 1.2;
    }
    
    .stat-label {
      font-size: 14px;
      color: #6b7280;
      margin-top: 4px;
    }
    
    .stat-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
      margin-top: 8px;
    }
    
    .group-tab {
      padding: 12px 24px;
      border: none;
      background: white;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s;
      border-bottom: 2px solid transparent;
    }
    
    .group-tab:hover {
      background: #f9fafb;
    }
    
    .group-tab.active {
      color: #3b82f6;
      border-bottom-color: #3b82f6;
    }
    
    .chart-container {
      position: relative;
      height: 400px;
      background: white;
      padding: 24px;
      border-radius: 0;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
  </style>
</head>
<body>
  <!-- Header -->
  <header class="bg-white shadow-sm sticky top-0 z-50 border-b">
    <div class="container mx-auto px-4">
      <div class="flex items-center justify-between" style="height: 56px;">
        <!-- å·¦ä¾§ï¼šæ ‡é¢˜ + è¿”å›é“¾æ¥ -->
        <div class="flex items-center gap-8">
          <a href="index.html" class="text-xl font-bold whitespace-nowrap flex items-center gap-2 text-blue-600 hover:text-blue-800">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
            å‚é“åšå®¢ç¿»è¯‘
          </a>

          <!-- ç»Ÿè®¡é¡µé¢æ ‡é¢˜ -->
          <h1 class="text-lg font-medium text-gray-600">æ•°æ®ç»Ÿè®¡åˆ†æ</h1>
        </div>

        <!-- å³ä¾§ï¼šä¸»é¢˜åˆ‡æ¢ + ç®€ç¹åˆ‡æ¢ -->
        <div class="flex items-center gap-3">
          <!-- PCç«¯ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
          <button id="themeToggleDesktop" class="theme-toggle-btn desktop-only" title="åˆ‡æ¢ä¸»é¢˜">
            <svg class="theme-icon-light" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="5"/>
              <line x1="12" y1="1" x2="12" y2="3"/>
              <line x1="12" y1="21" x2="12" y2="23"/>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
              <line x1="1" y1="12" x2="3" y2="12"/>
              <line x1="21" y1="12" x2="23" y2="12"/>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
            </svg>
            <svg class="theme-icon-dark" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
            </svg>
          </button>

          <!-- PCç«¯ç®€ç¹åˆ‡æ¢æŒ‰é’® -->
          <button id="langToggleDesktop" class="lang-toggle-btn desktop-only" title="åˆ‡æ¢åˆ°ç¹ä½“ä¸­æ–‡">
            <span class="lang-text">ç®€</span>
          </button>

          <!-- ç§»åŠ¨ç«¯æ±‰å ¡èœå•æŒ‰é’® -->
          <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- ç§»åŠ¨ç«¯ä¾§è¾¹æ èœå• -->
  <div class="mobile-overlay" onclick="toggleMobileMenu()"></div>
  <div class="mobile-sidebar">
    <div class="mobile-sidebar-header">
      <h2>èœå•</h2>
      <button class="mobile-sidebar-close" onclick="toggleMobileMenu()">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <nav class="mobile-sidebar-nav">
      <div class="mobile-nav-item">
        <a href="index.html" class="flex items-center gap-2">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          è¿”å›ä¸»é¡µ
        </a>
      </div>
      <div class="mobile-nav-item" data-group="all">
        <a href="index.html#all">å…¨éƒ¨</a>
      </div>
      <div class="mobile-nav-item" data-group="nogizaka">
        <a href="index.html#nogizaka">ä¹ƒæœ¨å‚46</a>
      </div>
      <div class="mobile-nav-item" data-group="sakurazaka">
        <a href="index.html#sakurazaka">æ¨±å‚46</a>
      </div>
      <div class="mobile-nav-item" data-group="hinatazaka">
        <a href="index.html#hinatazaka">æ—¥å‘å‚46</a>
      </div>
    </nav>

    <!-- ç§»åŠ¨ç«¯ä¸»é¢˜åˆ‡æ¢ -->
    <div class="mobile-theme-toggle">
      <button id="themeToggleMobile" class="theme-toggle-btn-mobile">
        <svg class="theme-icon-light" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="5"/>
          <line x1="12" y1="1" x2="12" y2="3"/>
          <line x1="12" y1="21" x2="12" y2="23"/>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
          <line x1="1" y1="12" x2="3" y2="12"/>
          <line x1="21" y1="12" x2="23" y2="12"/>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
        </svg>
        <svg class="theme-icon-dark" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
        <span class="theme-text">äº®è‰²æ¨¡å¼</span>
      </button>
    </div>

    <!-- ç§»åŠ¨ç«¯ç®€ç¹åˆ‡æ¢ -->
    <div class="mobile-lang-toggle">
      <button id="langToggleMobile" class="lang-toggle-btn-mobile">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h2m-1 0v6"/>
        </svg>
        <span class="lang-text">ç®€ä½“ä¸­æ–‡</span>
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <main class="container mx-auto px-4 py-8 max-w-7xl">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <h1 class="text-4xl font-bold text-center mb-8" style="color: #1f2937;">
      åšå®¢ç»Ÿè®¡åˆ†æ
    </h1>
    
    <!-- ç­›é€‰æ  -->
    <div class="bg-white shadow-sm p-6 mb-6" style="box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
      <div class="flex flex-wrap items-center gap-4">
        <div class="flex items-center gap-2">
          <label class="text-sm font-medium text-gray-700">å¹´ä»½</label>
          <select id="yearSelect" onchange="onFilterChange()" style="padding: 8px 16px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 14px; cursor: pointer; width: 120px;">
            <option value="2025" selected>2025å¹´</option>
            <option value="2024">2024å¹´</option>
            <option value="2023">2023å¹´</option>
          </select>
        </div>
        
        <div class="flex items-center gap-2">
          <label class="text-sm font-medium text-gray-700">æœˆä»½</label>
          <select id="monthSelect" onchange="onFilterChange()" style="padding: 8px 16px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 14px; cursor: pointer; width: 120px;">
            <option value="all">å…¨å¹´</option>
            <option value="1">1æœˆ</option>
            <option value="2">2æœˆ</option>
            <option value="3">3æœˆ</option>
            <option value="4">4æœˆ</option>
            <option value="5">5æœˆ</option>
            <option value="6">6æœˆ</option>
            <option value="7">7æœˆ</option>
            <option value="8">8æœˆ</option>
            <option value="9">9æœˆ</option>
            <option value="10" selected>10æœˆ</option>
            <option value="11">11æœˆ</option>
            <option value="12">12æœˆ</option>
          </select>
        </div>
      </div>
      
      <!-- å›¢ä½“æ ‡ç­¾ -->
      <div class="flex gap-2 mt-6 border-b">
        <button class="group-tab active" data-group="all" onclick="switchGroup('all')">
          å…¨éƒ¨å›¢ä½“
        </button>
        <button class="group-tab" data-group="nogizaka" onclick="switchGroup('nogizaka')">
          ä¹ƒæœ¨å‚46
        </button>
        <button class="group-tab" data-group="sakurazaka" onclick="switchGroup('sakurazaka')">
          æ¨±å‚46
        </button>
        <button class="group-tab" data-group="hinatazaka" onclick="switchGroup('hinatazaka')">
          æ—¥å‘å‚46
        </button>
      </div>
    </div>
    
    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <div id="statsCards" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
      <!-- LoadingçŠ¶æ€ -->
      <div class="stat-card col-span-full text-center py-8">
        <div class="text-gray-500">æ­£åœ¨åŠ è½½ç»Ÿè®¡æ•°æ®...</div>
      </div>
    </div>
    
    <!-- å›¾è¡¨ -->
    <div class="chart-container">
      <h2 class="text-xl font-bold mb-4" style="color: #1f2937;" id="chartTitle">
        æˆå‘˜åšå®¢ç»Ÿè®¡å›¾è¡¨ - ä¹ƒæœ¨å‚46 (å‰20å)
      </h2>
      <canvas id="memberChart"></canvas>
    </div>
  </main>

  <script>
    // âœ… ä½¿ç”¨çœŸå®APIè·å–æ•°æ®
    let realData = {};
    let isLoading = false;
    
    // ä¸´æ—¶mockæ•°æ®ï¼ˆAPIåŠ è½½å‰ä½¿ç”¨ï¼‰
    const mockData = {
      all: {
        members: 81,
        activeMembers: 81,
        totalMembers: 84,
        blogs: 4500,
        avgBlogs: 50,
        topMembers: [
          { name: 'æ± ç”°ç‘›ç´—', count: 200 },
          { name: 'è…åŸå’²æœˆ', count: 130 },
          { name: 'å²©æœ¬è“®åŠ ', count: 110 },
          { name: 'å±±ä¸‹ç¾æœˆ', count: 100 },
          { name: 'è³€å–œé¥é¦™', count: 95 },
          { name: 'é è—¤ã•ãã‚‰', count: 90 },
          { name: 'ç”°æ‘çœŸä½‘', count: 85 },
          { name: 'ç­’äº•ã‚ã‚„ã‚', count: 80 },
          { name: 'æŸ´ç”°æŸšèœ', count: 75 },
          { name: 'å°å·å½©', count: 70 },
          { name: 'é»’è¦‹æ˜é¦™', count: 65 },
          { name: 'äº”ç™¾åŸèŒ‰å¤®', count: 60 },
          { name: 'é‡‘å·ç´—è€¶', count: 58 },
          { name: 'ä¸­è¥¿ã‚¢ãƒ«ãƒ', count: 55 },
          { name: 'æ—ç‘ å¥ˆ', count: 52 },
          { name: 'å¼“æœ¨å¥ˆæ–¼', count: 50 },
          { name: 'äº•ä¸Šå’Œ', count: 48 },
          { name: 'å¥¥ç”°ã„ã‚ã¯', count: 45 },
          { name: 'å†¨é‡Œå¥ˆå¤®', count: 42 },
          { name: 'çŸ¢ä¹…ä¿ç¾ç·’', count: 40 }
        ]
      },
      nogizaka: {
        members: 20,
        activeMembers: 20,
        totalMembers: 38,
        blogs: 1612,
        avgBlogs: 48.8,
        topMembers: [
          { name: 'æ± ç”°ç‘›ç´—', count: 200 },
          { name: 'è…åŸå’²æœˆ', count: 130 },
          { name: 'å²©æœ¬è“®åŠ ', count: 110 },
          { name: 'å±±ä¸‹ç¾æœˆ', count: 100 },
          { name: 'è³€å–œé¥é¦™', count: 95 },
          { name: 'é è—¤ã•ãã‚‰', count: 90 },
          { name: 'ç”°æ‘çœŸä½‘', count: 85 },
          { name: 'ç­’äº•ã‚ã‚„ã‚', count: 80 },
          { name: 'æŸ´ç”°æŸšèœ', count: 75 },
          { name: 'å°å·å½©', count: 70 },
          { name: 'é»’è¦‹æ˜é¦™', count: 65 },
          { name: 'äº”ç™¾åŸèŒ‰å¤®', count: 60 },
          { name: 'é‡‘å·ç´—è€¶', count: 58 },
          { name: 'ä¸­è¥¿ã‚¢ãƒ«ãƒ', count: 55 },
          { name: 'æ—ç‘ å¥ˆ', count: 52 },
          { name: 'å¼“æœ¨å¥ˆæ–¼', count: 50 },
          { name: 'äº•ä¸Šå’Œ', count: 48 },
          { name: 'å¥¥ç”°ã„ã‚ã¯', count: 45 },
          { name: 'å†¨é‡Œå¥ˆå¤®', count: 42 },
          { name: 'çŸ¢ä¹…ä¿ç¾ç·’', count: 40 }
        ]
      },
      sakurazaka: {
        members: 28,
        activeMembers: 28,
        totalMembers: 28,
        blogs: 1450,
        avgBlogs: 45.3,
        topMembers: [
          { name: 'æ£®ç”°ã²ã‹ã‚‹', count: 150 },
          { name: 'å±±ï¨‘å¤©', count: 120 },
          { name: 'å®ˆå±‹éº—å¥ˆ', count: 105 },
          { name: 'ç”°æ‘ä¿ä¹ƒ', count: 98 },
          { name: 'æ¾ç”°é‡Œå¥ˆ', count: 92 },
          { name: 'è—¤å‰å¤éˆ´', count: 88 },
          { name: 'äº•ä¸Šæ¢¨å', count: 82 },
          { name: 'å¤§åœ’ç²', count: 78 },
          { name: 'å°æ± ç¾æ³¢', count: 75 },
          { name: 'å¢—æœ¬ç¶ºè‰¯', count: 70 },
          { name: 'ä¸­å¶‹å„ªæœˆ', count: 68 },
          { name: 'å¤§æ²¼æ™¶ä¿', count: 65 },
          { name: 'å°ç”°å€‰éº—å¥ˆ', count: 62 },
          { name: 'é è—¤ç†å­', count: 58 },
          { name: 'çš„é‡ç¾é’', count: 55 },
          { name: 'è°·å£æ„›å­£', count: 52 },
          { name: 'çŸ³æ£®ç’ƒèŠ±', count: 50 },
          { name: 'æ‘äº•å„ª', count: 48 },
          { name: 'å±±ä¸‹ç³æœˆ', count: 45 },
          { name: 'æ­¦å…ƒå”¯è¡£', count: 42 }
        ]
      },
      hinatazaka: {
        members: 36,
        activeMembers: 36,
        totalMembers: 29,
        blogs: 1438,
        avgBlogs: 57.5,
        topMembers: [
          { name: 'å°å‚èœç·’', count: 180 },
          { name: 'åŠ è—¤å²å¸†', count: 145 },
          { name: 'é½Šè—¤äº¬å­', count: 125 },
          { name: 'æ½®ç´—ç†èœ', count: 110 },
          { name: 'ä½ã€…æœ¨ä¹…ç¾', count: 105 },
          { name: 'ä¸Šæ‘ã²ãªã®', count: 98 },
          { name: 'é«˜ç€¬æ„›å¥ˆ', count: 92 },
          { name: 'æ¿±å²¸ã²ã‚ˆã‚Š', count: 88 },
          { name: 'ä¸¹ç”Ÿæ˜é‡Œ', count: 82 },
          { name: 'æ£®æœ¬èŒ‰è‰', count: 78 },
          { name: 'æ­£æºå¸é™½å­', count: 75 },
          { name: 'å±±å£é™½ä¸–', count: 70 },
          { name: 'å¹³å°¾å¸†å¤', count: 68 },
          { name: 'å®®åœ°ã™ã¿ã‚Œ', count: 65 },
          { name: 'çŸ³å¡šç‘¶å­£', count: 62 },
          { name: 'å¹³å²¡æµ·æœˆ', count: 58 },
          { name: 'å²¸å¸†å¤', count: 55 },
          { name: 'æ¸…æ°´ç†å¤®', count: 52 },
          { name: 'ç«¹å†…å¸Œæ¥é‡Œ', count: 50 },
          { name: 'æ¸¡è¾ºè‰å¥ˆ', count: 48 }
        ]
      }
    };
    
    let currentGroup = 'nogizaka';
    let chart = null;
    
    // âœ… å¤ç”¨ä¸»åº”ç”¨çš„å®˜æ–¹æ ‡å‡†é…ç½®ï¼ˆgroup-config.jsï¼‰
    const groupColors = {
      all: '#6b7280',
      nogizaka: window.GroupConfig?.getColor('nogizaka') || '#742581',
      sakurazaka: window.GroupConfig?.getColor('sakurazaka') || '#F19DB5',
      hinatazaka: window.GroupConfig?.getColor('hinatazaka') || '#7BC7E8'
    };
    
    const groupNames = {
      all: 'å…¨éƒ¨å›¢ä½“',
      nogizaka: window.GroupConfig?.getDisplayName('nogizaka') || 'ä¹ƒæœ¨å‚46',
      sakurazaka: window.GroupConfig?.getDisplayName('sakurazaka') || 'æ¨±å‚46',
      hinatazaka: window.GroupConfig?.getDisplayName('hinatazaka') || 'æ—¥å‘å‚46'
    };
    
    // æ›´æ–°å›¾è¡¨
    function updateChart(data, color) {
      const ctx = document.getElementById('memberChart').getContext('2d');
      
      if (chart) {
        chart.destroy();
      }
      
      // æ£€æŸ¥æ•°æ®æ˜¯å¦ä¸ºç©º
      if (!data || data.length === 0) {
        console.warn('[Stats] æ²¡æœ‰æ•°æ®å¯ä»¥æ˜¾ç¤ºå›¾è¡¨');
        return;
      }
      
      chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: data.map(m => m.name),
          datasets: [{
            label: 'åšå®¢æ•°é‡',
            data: data.map(m => m.count),
            backgroundColor: color,
            borderRadius: 6,
            barThickness: 30
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              padding: 12,
              titleFont: { size: 14 },
              bodyFont: { size: 13 },
              callbacks: {
                label: function(context) {
                  return `åšå®¢æ•°: ${context.parsed.y}ç¯‡`;
                }
              }
            }
          },
          scales: {
            x: {
              ticks: {
                font: { size: 11 },
                maxRotation: 45,
                minRotation: 45
              },
              grid: {
                display: false
              }
            },
            y: {
              beginAtZero: true,
              ticks: {
                font: { size: 12 },
                stepSize: 1,
                callback: function(value) {
                  // åªæ˜¾ç¤ºæ•´æ•°
                  if (Number.isInteger(value)) {
                    return value + 'ç¯‡';
                  }
                  return '';
                }
              },
              grid: {
                color: '#f3f4f6'
              }
            }
          }
        }
      });
    }
    
    // ä»çœŸå®APIåŠ è½½æ•°æ®
    async function loadRealData(group) {
      const apiBase = window.API_BASE_URL || window.API_BASE || 'https://api.sakamichi-tools.cn';
      
      // å¤„ç†groupåç§°
      let groupDisplayName;
      if (group === 'all') {
        groupDisplayName = 'all';
      } else {
        groupDisplayName = window.GroupConfig?.getDisplayName(group) || group;
      }
      
      console.log(`[Stats] åŠ è½½${groupDisplayName}æ•°æ®...`);
      
      try {
        isLoading = true;
        
        let allBlogs = [];
        let totalMembersCount = 0; // çœŸå®çš„æ€»æˆå‘˜æ•°
        let currentMembersList = []; // åœ¨ç±æˆå‘˜åå•
        
        // å¦‚æœæ˜¯å…¨éƒ¨å›¢ä½“ï¼Œéœ€è¦åˆ†åˆ«åŠ è½½ä¸‰ä¸ªå›¢ä½“
        if (group === 'all') {
          const groups = ['nogizaka', 'sakurazaka', 'hinatazaka'];
          for (const g of groups) {
            const gName = window.GroupConfig?.getDisplayName(g) || g;
            
            // åŠ è½½åšå®¢æ•°æ®
            const response = await fetch(
              `${apiBase}/api/blogs?group=${encodeURIComponent(gName)}&limit=2000`
            );
            const data = await response.json();
            if (data.success && data.blogs) {
              allBlogs = allBlogs.concat(data.blogs);
            }
            
            // åŠ è½½å®Œæ•´æˆå‘˜åˆ—è¡¨
            try {
              const membersResponse = await fetch(`${apiBase}/api/members/${g}`);
              if (membersResponse.ok) {
                const membersData = await membersResponse.json();
                // ç»Ÿè®¡æ€»æˆå‘˜æ•°å¹¶ä¿å­˜æˆå‘˜åå•
                if (membersData.generations) {
                  membersData.generations.forEach(gen => {
                    totalMembersCount += gen.members.length;
                    currentMembersList.push(...gen.members);
                  });
                }
              }
            } catch (error) {
              console.warn(`[Stats] è·å–${g}æˆå‘˜åˆ—è¡¨å¤±è´¥:`, error);
            }
          }
        } else {
          // åŠ è½½åšå®¢æ•°æ®
          const response = await fetch(
            `${apiBase}/api/blogs?group=${encodeURIComponent(groupDisplayName)}&limit=2000`
          );
          const data = await response.json();
          if (data.success && data.blogs) {
            allBlogs = data.blogs;
          }
          
          // åŠ è½½å®Œæ•´æˆå‘˜åˆ—è¡¨
          try {
            const membersResponse = await fetch(`${apiBase}/api/members/${group}`);
            if (membersResponse.ok) {
              const membersData = await membersResponse.json();
              // ç»Ÿè®¡æ€»æˆå‘˜æ•°å¹¶ä¿å­˜æˆå‘˜åå•
              if (membersData.generations) {
                membersData.generations.forEach(gen => {
                  totalMembersCount += gen.members.length;
                  currentMembersList.push(...gen.members);
                });
              }
            }
          } catch (error) {
            console.warn(`[Stats] è·å–${group}æˆå‘˜åˆ—è¡¨å¤±è´¥:`, error);
          }
        }
        
        if (allBlogs.length > 0) {
          console.log(`[Stats] æˆåŠŸåŠ è½½ ${allBlogs.length} ç¯‡åšå®¢`);
          
          // æŒ‰å¹´æœˆç­›é€‰
          const filteredBlogs = filterBlogsByDate(allBlogs);
          console.log(`[Stats] ç­›é€‰å ${filteredBlogs.length} ç¯‡åšå®¢`);
          console.log(`[Stats] åœ¨ç±æˆå‘˜æ•°: ${currentMembersList.length}`, currentMembersList.slice(0, 5), '...');
          
          // ç»Ÿè®¡æˆå‘˜æ•°æ®
          const memberStats = {};
          const notFoundMembers = new Set(); // è®°å½•æ‰¾ä¸åˆ°çš„æˆå‘˜
          
          // åˆ›å»ºæ— ç©ºæ ¼çš„æˆå‘˜åå•ç”¨äºåŒ¹é…
          const normalizedMembersList = currentMembersList.map(name => name.replace(/\s+/g, ''));
          
          // âš ï¸ ç‰¹æ®Šæˆå‘˜åˆ—è¡¨ï¼ˆä¸è®¡å…¥ç»Ÿè®¡ï¼‰
          const specialMembers = ['ãƒã‚«']; // æ—¥å‘å‚46å‰ç¥¥ç‰©
          
          filteredBlogs.forEach(blog => {
            const member = blog.member;
            if (!member) return;
            
            // è·³è¿‡ç‰¹æ®Šæˆå‘˜ï¼ˆä¸è®¡å…¥ç»Ÿè®¡ï¼‰
            if (specialMembers.includes(member)) {
              return;
            }
            
            // âœ… æ ‡å‡†åŒ–åå­—ï¼ˆå»æ‰ç©ºæ ¼ï¼‰
            const normalizedMember = member.replace(/\s+/g, '');
            
            // æ£€æŸ¥æˆå‘˜æ˜¯å¦åœ¨åå•ä¸­ï¼ˆå»ç©ºæ ¼æ¯”è¾ƒï¼‰
            if (currentMembersList.length > 0) {
              const memberIndex = normalizedMembersList.indexOf(normalizedMember);
              if (memberIndex === -1) {
                // ä¸æŠ¥é”™ï¼Œåªè®°å½•åˆ° notFoundMembersï¼ˆå¯èƒ½æ˜¯ç‰¹æ®Šæˆå‘˜ï¼‰
                notFoundMembers.add(member);
                return; // è·³è¿‡ä¸åœ¨åå•ä¸­çš„æˆå‘˜
              }
              // ä½¿ç”¨æ ‡å‡†åŒ–çš„åå­—ï¼ˆæ— ç©ºæ ¼ï¼‰ä½œä¸ºkey
              const standardName = currentMembersList[memberIndex];
              
              if (!memberStats[standardName]) {
                memberStats[standardName] = { name: standardName, count: 0 };
              }
              memberStats[standardName].count++;
            } else {
              // å¦‚æœæ²¡æœ‰æˆå‘˜åå•ï¼Œä½¿ç”¨æ ‡å‡†åŒ–åçš„åå­—
              if (!memberStats[normalizedMember]) {
                memberStats[normalizedMember] = { name: normalizedMember, count: 0 };
              }
              memberStats[normalizedMember].count++;
            }
          });
          
          // è¾“å‡ºæ‰¾ä¸åˆ°çš„æˆå‘˜ï¼ˆæ’é™¤ç‰¹æ®Šæˆå‘˜ï¼‰
          const reallyNotFound = Array.from(notFoundMembers).filter(m => !specialMembers.includes(m));
          if (reallyNotFound.length > 0) {
            console.warn(`[Stats] âš ï¸ ä»¥ä¸‹æˆå‘˜åœ¨æˆå‘˜åˆ—è¡¨ä¸­æ‰¾ä¸åˆ° (å…±${reallyNotFound.length}äºº):`, reallyNotFound);
            console.warn('[Stats] è¿™å¯èƒ½æ˜¯åå­—æ ¼å¼ä¸åŒ¹é…çš„é—®é¢˜');
          }
          
          // è®°å½•ç‰¹æ®Šæˆå‘˜ï¼ˆä»…ä½œä¿¡æ¯å±•ç¤ºï¼‰
          const foundSpecial = Array.from(notFoundMembers).filter(m => specialMembers.includes(m));
          if (foundSpecial.length > 0) {
            console.log(`[Stats] â„¹ï¸ æ£€æµ‹åˆ°ç‰¹æ®Šæˆå‘˜åšå®¢ï¼ˆä¸è®¡å…¥ç»Ÿè®¡ï¼‰:`, foundSpecial);
          }
          
          // æ’åºå–å‰20
          const topMembers = Object.values(memberStats)
            .sort((a, b) => b.count - a.count)
            .slice(0, 20);
          
          console.log(`[Stats] Top 20 æˆå‘˜:`, topMembers.map(m => `${m.name}:${m.count}`).join(', '));
          
          // è®¡ç®—ç»Ÿè®¡æ•°æ®
          const activeMembers = Object.keys(memberStats).length; // å‘äº†åšå®¢çš„æˆå‘˜æ•°
          const totalBlogs = filteredBlogs.length;
          const avgBlogs = activeMembers > 0 ? (totalBlogs / activeMembers).toFixed(1) : 0;
          
          realData[group] = {
            activeMembers: activeMembers, // å‘äº†åšå®¢çš„æˆå‘˜æ•°
            totalMembers: totalMembersCount || activeMembers, // çœŸå®æ€»æˆå‘˜æ•°
            members: activeMembers, // ä¸ºäº†å…¼å®¹æ€§ä¿ç•™
            blogs: totalBlogs,
            avgBlogs: parseFloat(avgBlogs),
            topMembers: topMembers,
            allBlogs: allBlogs // ä¿å­˜åŸå§‹æ•°æ®ç”¨äºé‡æ–°ç­›é€‰
          };
          
          console.log(`[Stats] ${groupDisplayName} ç»Ÿè®¡å®Œæˆ:`, {
            activeMembers: activeMembers,
            totalMembers: totalMembersCount,
            blogs: totalBlogs,
            avgBlogs: avgBlogs,
            topMembersCount: topMembers.length
          });
          
          // âŒ åˆ é™¤è‡ªåŠ¨æ›´æ–°ï¼Œé¿å…é—ªçƒ
          // åªåœ¨åˆå§‹åŒ–å®Œæˆæˆ–æ‰‹åŠ¨åˆ‡æ¢å›¢ä½“æ—¶æ›´æ–°
          
        } else {
          console.error('[Stats] æ²¡æœ‰è·å–åˆ°åšå®¢æ•°æ®');
        }
        
      } catch (error) {
        console.error(`[Stats] åŠ è½½${groupDisplayName}æ•°æ®å¤±è´¥:`, error);
        alert(`åŠ è½½æ•°æ®å¤±è´¥: ${error.message}\n\nå°†ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®å±•ç¤º`);
      } finally {
        isLoading = false;
      }
    }
    
    // æŒ‰æ—¥æœŸç­›é€‰åšå®¢
    function filterBlogsByDate(blogs) {
      const year = document.getElementById('yearSelect').value;
      const month = document.getElementById('monthSelect').value;
      
      return blogs.filter(blog => {
        if (!blog.publish_date) return false;
        
        const date = blog.formatted_date || blog.publish_date;
        
        // æå–å¹´ä»½å’Œæœˆä»½
        const match = date.match(/(\d{4})\.(\d{1,2})/);
        if (!match) return false;
        
        const blogYear = match[1];
        const blogMonth = parseInt(match[2]);
        
        // å¹´ä»½ç­›é€‰
        if (blogYear !== year) return false;
        
        // æœˆä»½ç­›é€‰
        if (month !== 'all' && blogMonth !== parseInt(month)) return false;
        
        return true;
      });
    }
    
    // æ—¶é—´ç­›é€‰æ”¹å˜æ—¶è§¦å‘
    function onFilterChange() {
      console.log('[Stats] æ—¶é—´ç­›é€‰æ”¹å˜ï¼Œé‡æ–°ç»Ÿè®¡...');
      
      // å¦‚æœæœ‰åŸå§‹æ•°æ®ï¼Œé‡æ–°ç»Ÿè®¡
      if (realData[currentGroup] && realData[currentGroup].allBlogs) {
        const allBlogs = realData[currentGroup].allBlogs;
        const filteredBlogs = filterBlogsByDate(allBlogs);
        
        // é‡æ–°ç»Ÿè®¡
        const memberStats = {};
        filteredBlogs.forEach(blog => {
          const member = blog.member;
          if (!member) return;
          
          if (!memberStats[member]) {
            memberStats[member] = { name: member, count: 0 };
          }
          memberStats[member].count++;
        });
        
        const topMembers = Object.values(memberStats)
          .sort((a, b) => b.count - a.count)
          .slice(0, 20);
        
        const activeMembers = Object.keys(memberStats).length;
        const totalBlogs = filteredBlogs.length;
        const avgBlogs = activeMembers > 0 ? (totalBlogs / activeMembers).toFixed(1) : 0;
        
        // æ›´æ–°å½“å‰æ•°æ®ï¼ˆä¿ç•™totalMembersï¼‰
        realData[currentGroup] = {
          ...realData[currentGroup],
          activeMembers: activeMembers,
          members: activeMembers,
          blogs: totalBlogs,
          avgBlogs: parseFloat(avgBlogs),
          topMembers: topMembers
        };
        
        updateStats();
      } else {
        // æ²¡æœ‰æ•°æ®ï¼Œé‡æ–°åŠ è½½
        loadRealData(currentGroup);
      }
    }
    
    // æ¸²æŸ“å¡ç‰‡
    function renderStatsCards() {
      const container = document.getElementById('statsCards');
      const year = document.getElementById('yearSelect').value;
      const month = document.getElementById('monthSelect').value;
      const monthText = month === 'all' ? 'å…¨å¹´' : `${month}æœˆ`;
      const periodText = `${year}å¹´${monthText}`;
      
      if (currentGroup === 'all') {
        // å…¨éƒ¨å›¢ä½“ï¼šæ˜¾ç¤ºä¸‰ä¸ªå›¢ä½“çš„è¯¦ç»†ä¿¡æ¯
        const groups = ['nogizaka', 'sakurazaka', 'hinatazaka'];
        // âœ… ä¿®å¤ï¼šä½¿ç”¨realDataæˆ–fallbackåˆ°mockData
        const totalBlogs = groups.reduce((sum, g) => {
          const gData = realData[g] || mockData[g];
          return sum + (gData?.blogs || 0);
        }, 0);
        const totalMembers = groups.reduce((sum, g) => {
          const gData = realData[g] || mockData[g];
          return sum + (gData?.totalMembers || gData?.members || 0);
        }, 0);
        const activeMembers = groups.reduce((sum, g) => {
          const gData = realData[g] || mockData[g];
          return sum + (gData?.activeMembers || gData?.members || 0);
        }, 0);
        const avgBlogs = activeMembers > 0 ? (totalBlogs / activeMembers).toFixed(1) : '0.0';
        
        container.innerHTML = `
          <!-- æ€»æˆå‘˜æ•° -->
          <div class="stat-card">
            <div class="stat-label">æ€»æˆå‘˜æ•°</div>
            <div class="stat-number" style="color: #3b82f6;">
              <span>${totalMembers || 100}</span><span style="font-size: 24px; margin-left: 4px;">äºº</span>
            </div>
            <div style="margin-top: 16px; space-y-2;">
              ${groups.map(g => {
                const gData = realData[g] || mockData[g];
                const gColor = groupColors[g];
                const activeCount = gData.activeMembers || gData.members;
                const totalCount = gData.totalMembers || gData.members;
                return `
                  <div class="flex justify-between items-center py-1">
                    <span class="text-sm text-gray-700">${groupNames[g]}</span>
                    <span class="text-lg font-bold px-3 py-1" style="background: ${gColor}20; color: ${gColor}; border-radius: 6px;">${activeCount}/${totalCount}äºº</span>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
          
          <!-- æ€»åšå®¢æ•° -->
          <div class="stat-card">
            <div class="stat-label">æ€»åšå®¢æ•°</div>
            <div class="stat-number" style="color: #f59e0b;">
              <span>${totalBlogs}</span><span style="font-size: 24px; margin-left: 4px;">ç¯‡</span>
            </div>
            <div style="margin-top: 16px; space-y-2;">
              ${groups.map(g => {
                const gData = realData[g] || mockData[g];
                const gColor = groupColors[g];
                return `
                  <div class="flex justify-between items-center py-1">
                    <span class="text-sm text-gray-700">${groupNames[g]}</span>
                    <span class="text-lg font-bold px-3 py-1" style="background: ${gColor}20; color: ${gColor}; border-radius: 6px;">${gData.blogs}ç¯‡</span>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
          
          <!-- æŸ¥è¯¢æ—¶æ®µ -->
          <div class="stat-card">
            <div class="stat-label">æŸ¥è¯¢æ—¶æ®µ</div>
            <div class="stat-badge" style="background: #d1fae5; color: #065f46; margin: 12px 0;">${periodText}</div>
            <div style="margin-top: 16px; space-y-2;">
              <div class="flex justify-between items-center py-1">
                <span class="text-sm text-gray-700">å¹³å‡åšå®¢æ•°</span>
                <span class="text-lg font-bold px-3 py-1" style="background: #10b98120; color: #10b981; border-radius: 6px;">${avgBlogs}ç¯‡/äºº</span>
              </div>
              ${groups.map(g => {
                const gData = realData[g] || mockData[g];
                const gColor = groupColors[g];
                return `
                  <div class="flex justify-between items-center py-1">
                    <span class="text-sm text-gray-700">${groupNames[g]}å¹³å‡</span>
                    <span class="text-lg font-bold px-3 py-1" style="background: ${gColor}20; color: ${gColor}; border-radius: 6px;">${gData.avgBlogs}ç¯‡/äºº</span>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        `;
      } else {
        // å•ä¸ªå›¢ä½“ï¼šæ˜¾ç¤ºç®€å•å¡ç‰‡
        const data = realData[currentGroup] || mockData[currentGroup];
        const color = groupColors[currentGroup];
        const groupName = groupNames[currentGroup];
        const activeCount = data.activeMembers || data.members;
        const totalCount = data.totalMembers || data.members;
        
        container.innerHTML = `
          <!-- æ€»æˆå‘˜æ•° -->
          <div class="stat-card">
            <div class="stat-label">æ€»æˆå‘˜æ•°</div>
            <div class="stat-number" style="color: #3b82f6;">
              <span>${activeCount}/${totalCount}</span><span style="font-size: 24px; margin-left: 4px;">äºº</span>
            </div>
            <div class="stat-badge" style="background: #dbeafe; color: #1e40af;">
              ${groupName}
            </div>
          </div>
          
          <!-- æ€»åšå®¢æ•° -->
          <div class="stat-card">
            <div class="stat-label">æ€»åšå®¢æ•°</div>
            <div class="stat-number" style="color: #f59e0b;">
              <span>${data.blogs}</span><span style="font-size: 24px; margin-left: 4px;">ç¯‡</span>
            </div>
            <div class="stat-badge" style="background: #fef3c7; color: #92400e;">
              ${data.blogs}ç¯‡
            </div>
          </div>
          
          <!-- æŸ¥è¯¢æ—¶æ®µ -->
          <div class="stat-card">
            <div class="stat-label">æŸ¥è¯¢æ—¶æ®µ</div>
            <div style="margin-top: 12px;">
              <div class="flex justify-between items-center mb-3">
                <span class="text-sm text-gray-600">å¹³å‡åšå®¢æ•°</span>
                <span class="text-xl font-bold" style="color: #10b981;">${data.avgBlogs}ç¯‡/äºº</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-sm text-gray-600">${groupName}å¹³å‡</span>
                <span class="text-xl font-bold" style="color: #10b981;">${data.avgBlogs}ç¯‡/äºº</span>
              </div>
            </div>
            <div class="stat-badge" style="background: #d1fae5; color: #065f46;">
              ${periodText}
            </div>
          </div>
        `;
      }
    }
    
    // ä¿®æ”¹updateStatsä½¿ç”¨çœŸå®æ•°æ®
    function updateStats() {
      // ä¼˜å…ˆä½¿ç”¨çœŸå®æ•°æ®ï¼Œå¦åˆ™ä½¿ç”¨mockæ•°æ®
      const data = realData[currentGroup] || mockData[currentGroup];
      const color = groupColors[currentGroup];
      const groupName = groupNames[currentGroup];
      
      console.log(`[Stats] updateStats - Group: ${currentGroup}`, {
        hasRealData: !!realData[currentGroup],
        topMembersCount: data.topMembers?.length || 0,
        totalBlogs: data.blogs
      });
      
      if (!realData[currentGroup]) {
        console.log(`[Stats] ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®å±•ç¤º ${groupName}`);
      }
      
      // æ¸²æŸ“å¡ç‰‡
      renderStatsCards();
      
      // æ›´æ–°å›¾è¡¨æ ‡é¢˜
      document.getElementById('chartTitle').textContent = `æˆå‘˜åšå®¢ç»Ÿè®¡å›¾è¡¨ - ${groupName} (å‰20å)`;
      
      // æ›´æ–°å›¾è¡¨
      console.log(`[Stats] å‡†å¤‡æ›´æ–°å›¾è¡¨ï¼Œæ•°æ®é•¿åº¦: ${data.topMembers?.length || 0}`);
      updateChart(data.topMembers, color);
    }
    
    // ä¿®æ”¹switchGroupåŠ è½½çœŸå®æ•°æ®
    function switchGroup(group) {
      currentGroup = group;
      
      // æ›´æ–°æ ‡ç­¾çŠ¶æ€
      document.querySelectorAll('.group-tab').forEach(tab => {
        tab.classList.remove('active');
        if (tab.dataset.group === group) {
          tab.classList.add('active');
        }
      });
      
      // å¦‚æœæ²¡æœ‰çœŸå®æ•°æ®ï¼Œå…ˆåŠ è½½
      if (!realData[group] && !isLoading) {
        loadRealData(group);
      } else {
        updateStats();
      }
    }
    
    // åˆå§‹åŒ– - ç­‰å¾…ç¬¬ä¸€ä¸ªå›¢ä½“æ•°æ®åŠ è½½å®Œæˆåå†æ˜¾ç¤º
    console.log('[Stats] åˆå§‹åŒ–ç»Ÿè®¡é¡µé¢...');
    currentGroup = 'all'; // é»˜è®¤æ˜¾ç¤ºå…¨éƒ¨å›¢ä½“
    
    // å¼‚æ­¥åŠ è½½æ‰€æœ‰å›¢ä½“æ•°æ®
    async function loadAllGroups() {
      console.log('[Stats] å¼€å§‹åŠ è½½æ‰€æœ‰å›¢ä½“æ•°æ®...');
      // å…ˆåŠ è½½å„ä¸ªå›¢ä½“çš„æ•°æ®
      await loadRealData('nogizaka');
      await loadRealData('sakurazaka');
      await loadRealData('hinatazaka');
      // æœ€ååŠ è½½allæ•°æ®å¹¶æ˜¾ç¤º
      await loadRealData('all');
      console.log('[Stats] æ‰€æœ‰å›¢ä½“æ•°æ®åŠ è½½å®Œæˆï¼');
      // âœ… æ•°æ®åŠ è½½å®Œæˆåæ‰ç¬¬ä¸€æ¬¡æ˜¾ç¤º
      updateStats();
    }
    
    loadAllGroups();
    
    // ğŸ¯ ç»Ÿè®¡é¡µé¢ SEO æ›´æ–°ï¼ˆæ¨¡å—åŒ–ï¼‰
    if (App.seo && App.seo.manager) {
      App.seo.manager.updateStatsMeta();
    }
  </script>
</body>
</html>
