<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>CDNé€Ÿåº¦æµ‹è¯•</title>
  <style>
    body { font-family: Arial; padding: 20px; max-width: 800px; margin: 0 auto; }
    .result { padding: 10px; margin: 10px 0; border-radius: 5px; }
    .fast { background: #d4edda; border: 1px solid #c3e6cb; }
    .slow { background: #f8d7da; border: 1px solid #f5c6cb; }
    button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>ğŸ§ª CDNé€Ÿåº¦æµ‹è¯•ï¼ˆä¸­å›½ç”¨æˆ·ä¸“ç”¨ï¼‰</h1>
  <p>ç‚¹å‡»æŒ‰é’®æµ‹è¯•3ä¸ªå…è´¹CDNåœ¨ä¸­å›½çš„è®¿é—®é€Ÿåº¦</p>
  <button onclick="testCDNs()">å¼€å§‹æµ‹è¯•</button>
  <div id="results"></div>

  <script>
    async function testCDNs() {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = '<p>â³ æµ‹è¯•ä¸­...</p>';
      
      const testImage = 'https://www.nogizaka46.com/files/46/diary/n46/MEMBER/moblog/202510/mobZvoZoV.jpg';
      
      const cdns = {
        'Cloudinaryï¼ˆç¾å›½ï¼Œä¸­å›½æœ‰èŠ‚ç‚¹ï¼‰': `https://res.cloudinary.com/demo/image/fetch/w_400,q_75,f_auto/${encodeURIComponent(testImage)}`,
        'ImageKitï¼ˆå°åº¦ï¼Œäºšå¤ªå¿«ï¼‰': `https://ik.imagekit.io/demo/tr:w-400,q-75/${encodeURIComponent(testImage)}`,
        'Weservï¼ˆè·å…°ï¼Œå…¨çƒCDNï¼‰': `https://images.weserv.nl/?url=${encodeURIComponent(testImage)}&w=400&q=75`,
        'åŸå›¾ï¼ˆæ—¥æœ¬ï¼‰': testImage
      };
      
      const results = [];
      
      for (const [name, url] of Object.entries(cdns)) {
        try {
          const start = performance.now();
          const response = await fetch(url, { mode: 'no-cors' });
          const time = Math.round(performance.now() - start);
          
          // ç”¨Imageæ ‡ç­¾å†æµ‹ä¸€æ¬¡ï¼ˆæ›´å‡†ç¡®ï¼‰
          await new Promise((resolve, reject) => {
            const imgStart = performance.now();
            const img = new Image();
            img.onload = () => {
              const imgTime = Math.round(performance.now() - imgStart);
              results.push({ name, time: imgTime, url });
              resolve();
            };
            img.onerror = () => {
              results.push({ name, time: 9999, error: true, url });
              resolve();
            };
            img.src = url;
          });
        } catch (err) {
          results.push({ name, time: 9999, error: true, url });
        }
      }
      
      // æ’åºå¹¶æ˜¾ç¤ºç»“æœ
      results.sort((a, b) => a.time - b.time);
      
      let html = '<h2>ğŸ“Š æµ‹è¯•ç»“æœï¼š</h2>';
      results.forEach((result, index) => {
        const fastOrSlow = result.time < 1000 ? 'fast' : 'slow';
        const emoji = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : 'ğŸ“';
        const status = result.error ? 'âŒ å¤±è´¥' : `âœ… ${result.time}ms`;
        
        html += `
          <div class="result ${fastOrSlow}">
            <strong>${emoji} ${result.name}</strong><br>
            ${status}<br>
            <small style="color: #666;">${result.url.substring(0, 80)}...</small>
          </div>
        `;
      });
      
      html += '<h3>ğŸ’¡ å»ºè®®ï¼š</h3>';
      const fastest = results[0];
      if (fastest.time < 500) {
        html += `<p style="color: green;">âœ… ä½¿ç”¨ <strong>${fastest.name}</strong>ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼</p>`;
      } else if (fastest.time < 1500) {
        html += `<p style="color: orange;">âš ï¸ ä½¿ç”¨ <strong>${fastest.name}</strong>ï¼Œé€Ÿåº¦å¯æ¥å—ã€‚</p>`;
      } else {
        html += `<p style="color: red;">âŒ æ‰€æœ‰CDNéƒ½æ…¢ï¼Œå»ºè®®è‡ªå»ºå‹ç¼©æ–¹æ¡ˆã€‚</p>`;
      }
      
      resultsDiv.innerHTML = html;
    }
  </script>
</body>
</html>
